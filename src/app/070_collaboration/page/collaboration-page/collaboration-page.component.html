<app-header *ngIf="header" [header]="header"></app-header>
<app-navbar></app-navbar>

<section class="container my-5">
  <div class="row justify-content-center">
    <div class="col-12 col-md-6">
      <h1 class="mb-3 fw-bold text-primary">Experimento do Pequeno Mundo</h1>
      <p class="text-muted">
        A teoria propõe que qualquer pessoa no planeta pode estar conectada a qualquer outra através de, no máximo, seis intermediários.
      </p>
      <hr />
      <p class="mb-4">
        Informe o nome de dois autores, e o sistema buscará as conexões entre eles.
      </p>

      <!-- FORM -->
      <form [formGroup]="contactForm" (ngSubmit)="onSubmit()" novalidate>
        <!-- Autor Origem -->
        <div class="mb-3 position-relative">
          <label for="author" class="form-label fw-semibold">Origem</label>
          <input
            id="author"
            type="text"
            class="form-control"
            formControlName="author"
            placeholder="Digite o nome do autor"
            autocomplete="off"
            [class.is-invalid]="authorCtrl.invalid && (authorCtrl.dirty || authorCtrl.touched)"
          />
          <ul
            *ngIf="suggestionsAuthor.length"
            class="list-group position-absolute w-100 shadow-sm"
            style="z-index: 1000; max-height: 200px; overflow-y: auto"
          >
            <li
              class="list-group-item list-group-item-action"
              *ngFor="let item of suggestionsAuthor"
              (click)="selectAuthor(item)"
            >
              {{ item.name }}
            </li>
          </ul>
        </div>

        <!-- Autor Destino -->
        <div class="mb-3 position-relative">
          <label for="coauthor" class="form-label fw-semibold">Destino (Alvo)</label>
          <input
            id="coauthor"
            type="text"
            class="form-control"
            formControlName="coauthor"
            placeholder="Digite o nome do outro autor"
            autocomplete="off"
            [class.is-invalid]="coauthorCtrl.invalid && (coauthorCtrl.dirty || coauthorCtrl.touched)"
          />
          <ul
            *ngIf="suggestionsCoauthor.length"
            class="list-group position-absolute w-100 shadow-sm"
            style="z-index: 1000; max-height: 200px; overflow-y: auto"
          >
            <li
              class="list-group-item list-group-item-action"
              *ngFor="let item of suggestionsCoauthor"
              (click)="selectCoauthor(item)"
            >
              {{ item.name }}
            </li>
          </ul>
        </div>

        <!-- Botão -->
        <div class="text-end">
          <button type="submit" class="btn btn-primary px-4" [disabled]="contactForm.invalid">
            Buscar Conexões
          </button>
        </div>
      </form>

      <!-- Referências -->
      <div class="mt-5 small text-muted">
        <h6>Referências</h6>
        <p>KARINTHY, Frigyes. <strong>CHAINS</strong>. In: Everything is different. Budapeste: Officina, 1929.</p>
        <p>MILGRAM, Stanley. <strong>The small-world problem</strong>. <em>Psychology Today</em>, 1967.</p>
      </div>
    </div>

    <!-- RESULTADO -->
    <div class="col-12 col-md-6 mt-4 mt-md-0">
      <div *ngIf="isLoading" class="text-center py-5">
        <div class="hourglass mx-auto"></div>
        <p class="text-muted mt-3">Buscando conexões...</p>
      </div>

      <div *ngIf="!isLoading && data">
        <div class="card shadow-sm border-0 p-3">
          <h5 class="fw-bold text-center text-primary">Resultado</h5>
          <p class="text-center mb-1"><strong>Origem:</strong> {{ data.origin }}</p>
          <p class="text-center mb-1"><strong>Destino:</strong> {{ data.target }}</p>
          <p class="text-center mb-3"><strong>Distância:</strong> {{ data.distance }}</p>

          <ul class="list-group">
            <li
              class="list-group-item border-0 fade-in"
              *ngFor="let step of data.path; let i = index"
              [style.animationDelay]="i * 0.5 + 's'"
            >
              <i class="bi bi-person-fill text-primary"></i>
              <strong>{{ step.step }}</strong> - {{ step.node }}
            </li>
          </ul>
        </div>
      </div>

      <div *ngIf="!isLoading && data?.path?.length === 0" class="text-center mt-4">
        <i class="bi bi-emoji-frown text-secondary" style="font-size: 3rem;"></i>
        <p class="mt-2 text-muted">Nenhuma conexão encontrada entre os autores.</p>
      </div>
    </div>
  </div>
</section>

<app-footer></app-footer>
